# mongo-dao-generator

[English Document](README.md)

### 1.介绍

mongo-dao-generator是一个自动化生成MongoDB数据访问对象（Data Access Object）的工具。

### 2.优势

* 支持primitive.ObjectID、primitive.DateTime类型的自动填充。

* 支持int、int8、int16、int32、int64、uint、uint8、uint16、uint32、uint64类型的自增长。

* 提供了对数据库字段的统一生成方案，避免了业务代码中随处可见的数据库字段的问题。

* 提供了包括InsertOne、InsertMany、UpdateOne、UpdateOneByID、UpdateMany、FindOne、FindOneByID、FindMany、DeleteOne、DeleteOneByID、DeleteMany、Count、Aggregate等多种数据库操作接口。

* 提供了对数据库操作接口的扩展能力。

* 提供了分包与不分包两种包解决方案。

* 支持目录和文件名风格的自定义。

### 3.安装

```shell
go intall github.com/dobyte/mongo-dao-generator
```

### 4.用法

```shell
Usage of mongo-dao-generator:
    mongo-dao-generator [flags] -model-dir=. -model-names=T,T -dao-dir=./dao
For more information, see:
    https://github.com/dobyte/mongo-dao-generator
Flags:
  -counter-name string
        specify the counter name; default is counter
  -dao-dir string
        specify the output directory of dao files; must be set
  -dao-pkg-path string
        specify the package path corresponding to the output directory of the dao files; automatically generated by default
  -file-style string
        specify the generation style for file; options: kebab | underscore | lower | camel | pascal; default is underscore (default "underscore")
  -model-dir string
        specify the model directory; must be set
  -model-names string
        specify the comma-separated list of model name; must be set
  -model-pkg-alias string
        specify a model package alias; default no alias
  -model-pkg-path string
        specify the package path corresponding to the model directory; automatically calculated by default
  -subpkg-enable
        specify whether to enable subpkg; default disable
  -subpkg-style string
        specify the generation style for subpkg; options: kebab | underscore | lower | camel | pascal; default is kebab (default "kebab")
```

### 5.标签

在模型定义中支持对gen标签的解析，目前支持以下标签解析：

| 标签名称     |                                                            | 示例                 | 说明                         |
| -------- | ---------------------------------------------------------- | ------------------ | -------------------------- |
| autoFill | primitive.ObjectID、primitive.DateTime                      | gen:"autoFill"     |                            |
| autoIncr | int、int8、int16、int32、int64、uint、uint8、uint16、uint32、uint64 | gen:"autoIncr:uid" | 该自增为原子操作，会在生成代码时同步生成计数器代码。 |

### 6.示例

###### 6-1.创建模型

model/mail.go

```go
package model

import "go.mongodb.org/mongo-driver/bson/primitive"

//go:generate mongo-dao-generator -model-dir=. -model-names=Mail -dao-dir=../dao/
type Mail struct {
    ID       primitive.ObjectID `bson:"_id" gen:"autoFill"`       // 邮件ID
    Title    string             `bson:"title"`                    // 邮件标题
    Content  string             `bson:"content"`                  // 邮件内容
    Sender   int64              `bson:"sender"`                   // 邮件发送者
    Receiver int64              `bson:"receiver"`                 // 邮件接受者
    Status   int                `bson:"status"`                   // 邮件状态
    SendTime primitive.DateTime `bson:"send_time" gen:"autoFill"` // 发送时间
}
```

###### 6-2.生成dao文件

```bash
% go generate ./...
```
